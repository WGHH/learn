## 1. 头部分类

```js
// 所在当前页的分类：一级分类根据类名设置样式current-level
var hrefArr = window.location.href.substr(window.location.href.indexOf("<?php echo $_SERVER['HTTP_HOST'] ?>")).split("/");
var currenhref = window.location.href;
var rule = "-c_[a-zA-z0-9]+\.html";
$(".pc-header #nav ul.level1>li").each(function(){
	if(hrefArr.length < 3){
		var catahref = $(this).find("a").attr("href");
		if(currenhref.substr(0, currenhref.search(rule)) == catahref.substr(0, catahref.search(rule))){
			$(this).addClass("current-level");
		}
	}else{
		if(hrefArr[1].replace(/-/g, " ") == ($($(this).find("a>span")[0]).text()).toLowerCase()){
			$(this).addClass("current-level");
		}
	}
});
```

```js
// 调节分类border-right
function setNavLiBorder(){
    let level1CateArr = $(".pc-header #nav ul.level1:last-child>li");
    for(let i = 0; i < level1CateArr.length; i++){
		if(level1CateArr[i+1] && level1CateArr[i].offsetTop != level1CateArr[i+1].offsetTop){
			$(level1CateArr[i]).css("border-right", "none");
		}
    }
}
```


```js
// 调节三级分类位置，二级和三级分开显示
function setNavLevel3Pos(){
	let level2LiArr = $("#nav ul.level2");
	for(let i = 0; i < level2LiArr.length; i++){
		if($(level2LiArr[i]).offset().left >= $("body").outerWidth(true) / 2){
			$(level2LiArr[i]).css("right", "-10px").css("left", "auto");
			let level3Arr = $(level2LiArr[i]).find("ul.level3");
			for(let j = 0; j < level3Arr.length; j++){
				$(level3Arr[j]).css("right", "100%").css("left", "auto");
			}
		}else{
			$(level2LiArr[i]).css("left", "10px").css("right", "auto");
			let level3Arr = $(level2LiArr[i]).find("ul.level3");
			// console.log(level3Arr);
			for(let j = 0; j < level3Arr.length; j++){
				$(level3Arr[j]).css("left", "100%").css("right", "auto");
			}
		}
	}
}
```

```js
// 调整二级分类位置，二级分类和三级分类一起显示
function setNavLevel2Pos(){
	let level1LiArr = $("#nav ul.level1>li.category-top");
	for(let i = 0; i < level1LiArr.length; i++){
		let $level2 = $(level1LiArr[i]).find("ul.level2");
		let level1_Left = getElementLeft(level1LiArr[i]); // 一级分类距离网页左上角的绝对位置left
		let level1Left_to_end_distance = $("body").outerWidth(true) - level1_Left; //一级分类左上角 到 网页右边界的距离

		if(level1Left_to_end_distance <= $level2.outerWidth(true)){ // 往左边放
			let level1_mid_to_end = level1Left_to_end_distance - ($(level1LiArr[i]).outerWidth(true)>>1); // 一级分类中点处 到 网页右边界的距离
			let translateX = level1_mid_to_end >= ($level2.outerWidth(true)>>1) ? "translateX(50%)" : "translateX(" + ( level1_mid_to_end - 10 ) + "px)"
            		$level2.css({
				right: '50%',
				left: 'auto',
				transform: translateX
			});
		}else{ //往右边放
			let level1_mid_to_start = level1_Left + ($(level1LiArr[i]).outerWidth(true)>>1); // 一级分类中点处 到 网页左边界的距离
			let translateX = level1_mid_to_start >= ($level2.outerWidth(true)>>1) ? "translateX(-50%)" : "translateX(-" + ( level1_mid_to_start - 10 ) + "px)"
		    	$level2.css({
				right: 'auto',
				left: '50%',
				transform: translateX
		    	});
		}
	}
}

// 获取元素绝对位置
function getElementLeft(element){
	var actualLeft = element.offsetLeft;
	var current = element.offsetParent;
	while (current !== null){
		actualLeft += current.offsetLeft;
		current = current.offsetParent;
	}
	return actualLeft;
}
```

```js
// 头部固定，内容不够，页面闪动的
if(($(".header-fixed").length == 0) && ($("body")[0].scrollHeight-($('.pc-header .nav-container')[0].clientHeight)*2<=(window.innerHeight))) {
	// .header-fixed已经固定过就不走这一步
	$(".pc-header .nav-container").removeClass("header-fixed"); //.pc-header .nav-container：谁固定就放谁
	return;
}
```
